---
title: Install the Cloud Native Toolkit on an existing cluster using GitOps
tabs: ['GitOps with Cloud Native Toolkit', 'GitOps with App Connect', 'GitOps with API Connect']
---

import Globals from 'gatsby-theme-carbon/src/templates/Globals';

<PageDescription>

_This is a work in progress, come back for updates._

Steps to install the <Globals name="shortName" /> in an existing OpenShift cluster using a declarative approach with ArgoCD.

</PageDescription>

## Pre-requisites
  - Provision an OpenShift cluster.
  - Install the `oc` and `git` cli.
  - Install the [Cloud Native Toolkit CLI](https://cloudnativetoolkit.dev/getting-started/cli).

---

## Installation
1. Fork the [multi-tenancy-gitops](https://github.com/cloud-native-toolkit/multi-tenancy-gitops) repository and clone your fork.
  ```shell script
  git clone git@github.com:{gitid}/multi-tenancy-gitops.git
  ```

2. Update the cloned repository.

    - Search and replace `cloud-native-toolkit` GithUb Org references with your {gitid}.
    - Search and replace `master` with the branch you would like to use.
    - The gitops repository is structured into different layers (ie. `1-apps`, `2-services`, `3-infra`).

    ```
        .
    ├── 0-bootstrap
    ├── 1-apps
    ├── 2-services
    ├── 3-infra
    ├── 4-rhacm
    ├── README.md
    └── bootstrap.yaml
    ```

    - Each layer is structured in a similar pattern consisting of an `argocd` folder and folder(s) for groupings of resources.

      The `argocd` folder contains a set of ArgoCD Application YAMLs which references the directory path that contains the YAMLs of the corresponding resources.

      The other folder(s) under each layer contains the YAMLs of resources such as namespace, operator, tools, etc that can be deployed on the cluster.
      The menu of resources can be expanded upon to include additional YAMLs.

    ```
    1-apps/
    ├── argocd
    └── instances

    2-services/
    ├── argocd
    ├── instances
    └── operators

    3-infra/
    ├── argocd
    ├── clusterrole
    ├── consolelink
    ├── consolenotification
    └── namespaces
    ```

    - The `argocd` folder contains an `active` and `inactive` sub-folder.  To install a specific resource, simply move the ArgoCD Application yaml(s) from the `inactive` -> `active` folder.

    ```
    3-infra/argocd/
    ├── active
    └── inactive
    ```

    - Review the available resources in the repository for each of the 3 layers and customize your repository to select what you would like to deploy by moving the ArgoCD Application.

      Once you have completed, commit and push your changes to the target branch.

3. Install the Red Hat OpenShift GitOps operator using the commands below or directly from the OpenShift Web Console.  An instance of ArgoCD will automatically be created in the `openshift-gitops` namespace.
  ```shell script
  cd multi-tenancy-gitops

  oc apply -f 2-services/operators/openshift-gitops/ -n openshift-operators
  ```

4. Review and apply the custom ClusterRole permissions to the ArgoCD Application Controller service account.  This is required for ArgoCD to create the required Kubernetes resources in target namespaces.
  ```shell script
  cd multi-tenancy-gitops

  oc apply -f 3-infra/clusterrole/
  ```

5. Create the bootstrap ArgoCD application.

  The bootstrap application will create the parent ArgoCD Application for each layer (YAMLs are located in `0-bootstrap` folder).
  The parent ArgoCD Applications will subsequently create child ArgoCD Applications in the `/argocd/active` directory.

  Depending on what resources have been selected, it will take some time for the ArgoCD to deploy the resources.
 ```shell script
 oc apply -f bootstrap.yaml -n openshift-gitops
 ```

6. Log on to the ArgoCD Web Console and verify the resources selected in the previous step has been successfully synced and are healty.
  ```
  # ArgoCD Web Console URL
  echo https://$(oc get route argocd-server -o jsonpath='{ .spec.host }' -n openshift-gitops)

  # Admin password
  oc extract secret/argocd-cluster-cluster --to=- -n openshift-gitops
  ```

7. From the OpenShift Web Console, verify the resources (ie, operators, namespaces, etc) have been successfully created and/or deployed.
